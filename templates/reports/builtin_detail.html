{% extends "base/list.html" %}
{% block title_text %}{{ report.name }}{% endblock title_text %}
{% block objects_title %}{{ report.name }}{% endblock objects_title %}
{% block object_type %}Report{% endblock object_type %}

{% block content %}
<div class="bodyHeader clearfix d-flex justify-content-between align-items-center" style="margin-bottom:8px;">
    <div>
        <h1 class="mb-0">{{ report.name }}</h1>
        <p class="text-muted mb-0">{{ report.description }}</p>
    </div>
    <div class="btn-group">
        <a class="btn btn-outline-secondary" href="{% url 'reports:builtin_export' slug=report.slug fmt='csv' %}?{% if request.GET %}{{ request.GET.urlencode }}{% endif %}">CSV</a>
        <a class="btn btn-outline-secondary" href="{% url 'reports:builtin_export' slug=report.slug fmt='excel' %}?{% if request.GET %}{{ request.GET.urlencode }}{% endif %}">Excel</a>
    </div>
</div>

<form method="get" class="card card-body mb-3">
    <div class="row g-2">
        <div class="col-12 col-md-3">
            <label class="form-label">Facility Slug</label>
            <input type="text" name="facility_slug" class="form-control" value="{{ filters.facility_slug|default_if_none:'' }}">
        </div>
        <div class="col-12 col-md-3">
            <label class="form-label">Faction Slug</label>
            <input type="text" name="faction_slug" class="form-control" value="{{ filters.faction_slug|default_if_none:'' }}">
        </div>
        <div class="col-12 col-md-3">
            <label class="form-label">Start Date</label>
            <input type="date" name="start" class="form-control" value="{{ filters.start|default_if_none:'' }}">
        </div>
        <div class="col-12 col-md-3">
            <label class="form-label">End Date</label>
            <input type="date" name="end" class="form-control" value="{{ filters.end|default_if_none:'' }}">
        </div>
        <div class="col-12 col-md-3 form-check mt-4">
            <input class="form-check-input" type="checkbox" value="1" name="unscoped" id="unscoped" {% if filters.unscoped %}checked{% endif %}>
            <label class="form-check-label" for="unscoped">
                Unscope (admins only)
            </label>
        </div>
        <div class="col-12 col-md-3 mt-4">
            <button class="btn btn-primary" type="submit">Apply Filters</button>
            <a class="btn btn-outline-secondary" href="{% url 'reports:builtin_detail' slug=report.slug %}">Reset</a>
        </div>
    </div>
</form>

<div class="table-responsive">
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                {% for col in columns %}
                    <th>{{ col }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row in table_rows %}
                <tr>
                    {% for cell in row %}
                        <td>{{ cell }}</td>
                    {% endfor %}
                </tr>
            {% empty %}
                <tr><td colspan="{{ columns|length }}" class="text-center text-muted">No data found for this scope.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock content %}
